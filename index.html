<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles/index.css" />
  </head>
  <body>
    <div id="NAVBAR"></div>
  </body>
</html>
<script type="module">
  import navbar from "./components/navbar.js";
  document.getElementById("NAVBAR").innerHTML = navbar();
  navigator.geolocation.getCurrentPosition(success, error);
  function success(position) {
    loc(position.coords.latitude, position.coords.longitude);
  }

  function error() {
    alert("Please Allow To Access Location");
    let place = document.createElement("h2");
    place.innerText = "Please Allow To Access Location";
    document.getElementById("locName").append(place);
  }

  async function loc(lat, lon) {
    let response = await fetch(
      `http://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=da1de6ea55bd1a35ca6697fad73464ab`
    );
    let data = await response.json();
    console.log("data:", data[0].name, data[0].state);
    let place = document.createElement("p");
    place.innerText = data[0].name + "-" + data[0].state;
    let head = document.createElement("h2");
    head.innerText = "Delivery in 14 minutes";
    document.getElementById("locName").append(head, place);
  }

  // document.getElementById("sbtn").addEventListener("click", f);
  document.getElementById("search").addEventListener("click", f);
  async function f() {
    if (document.getElementById("sugBox").style.display == "block") {
      document.getElementById("sugBox").style.display = "none";
    } else {
      document.getElementById("sugBox").style.display = "block";
      document.getElementById("myDropdown").style.display = "none";
    }

    let response = await fetch(`https://fakestoreapi.com/products?limit=5`);
    let data = await response.json();

    append(data);
  }

  function append(data) {
    document.getElementById("sugBox").innerHTML = "";
    data.forEach((elem) => {
      let { title, image } = elem;
      let div = document.createElement("div");
      let head = document.createElement("p");
      head.innerText = title;
      let img = document.createElement("img");
      img.src = image;
      div.append(head, img);
      document.getElementById("sugBox").append(div);
    });
  }

  document.getElementById("mycart").addEventListener("click", getCartPage);
  function getCartPage() {
    document.getElementById("sideCart").style.display = "block";
  }

  document.getElementById("closeCart").addEventListener("click", closeCartPage);
  function closeCartPage() {
    document.getElementById("sideCart").style.display = "none";
  }

  document.getElementById("cat2").addEventListener("click", loginForm);

  function loginForm() {
    document.getElementById("cat3").style.display = "none";
    document.getElementById("cusOTP").style.display = "none";
    document.getElementById("login").style.display = "block";
    document.getElementById("mainNav").style.opacity = "0.1";
    document.getElementById("sugBox").style.opacity = "0.1";
    document.getElementById("sideCart").style.opacity = "0.1";
  }
  document.getElementById("getOtp").addEventListener("click", getOTP);
  function getOTP() {
    let u = document.getElementById("cusNum").value;
    localStorage.setItem("userName", JSON.stringify(u));
    document.getElementById("cusNum").style.display = "none";
    document.getElementById("cusOTP").style.display = "inline";
    document.getElementById("changeToOtp").innerText = "Enter OTP";
    document.getElementById("getOtp").innerText = "Done";
    var timeLeft = 10;
    var elem = document.getElementById("timerOTP");
    var timerId = setInterval(countdown, 1000);

    function countdown() {
      if (timeLeft == -1) {
        clearTimeout(timerId);
        elem.innerText = "Resend OTP";
      } else {
        elem.innerText = timeLeft + " seconds remaining";
        timeLeft--;
      }
    }
    document.getElementById("getOtp").addEventListener("click", doneOTP);
  }
  var lc;
  function doneOTP() {
    lc = JSON.parse(localStorage.getItem("userName"));
    document.getElementById("localName").innerText = lc;
    document.getElementById("login").style.display = "none";
    document.getElementById("mainNav").style.opacity = "1";
    document.getElementById("sugBox").style.opacity = "1";
    document.getElementById("sideCart").style.opacity = "1";
    // document.getElementById("cat2").innerText = "profile";
    document.getElementById("cat2").style.display = "none";
    document.getElementById("cat3").style.display = "block";
    document.getElementById("cat3").addEventListener("click", () => {
      document.getElementById("login").style.display = "none";
      document.getElementById("mainNav").style.opacity = "1";
      document.getElementById("sugBox").style.opacity = "1";
      document.getElementById("sideCart").style.opacity = "1";
      if (document.getElementById("myDropdown").style.display == "none") {
        document.getElementById("myDropdown").style.display = "block";
        document.getElementById("sugBox").style.display = "none";
      } else {
        document.getElementById("myDropdown").style.display = "none";
      }
    });
  }

  let cartArr = [
    {
      cat: "veg",
      image:
        "https://cdn.grofers.com/cdn-cgi/image/f=auto,fit=scale-down,q=85,metadata=none,w=250,h=250/app/images/products/sliding_image/421703a.jpg",
      name: "Ginger (Adrak)",
      price: "10",
      wt: "250 g",
    },
    {
      cat: "veg",
      image:
        "https://cdn.grofers.com/cdn-cgi/image/f=auto,fit=scale-down,q=85,metadata=none,w=250,h=250/app/images/products/sliding_image/438111a.jpg",
      name: "Fenugreek (Methi) - Fresh",
      price: "6",
      wt: "250 g",
    },
    {
      cat: "veg",
      image:
        "https://cdn.grofers.com/cdn-cgi/image/f=auto,fit=scale-down,q=85,metadata=none,w=250,h=250/app/images/products/sliding_image/3888a.jpg",
      name: "Green Capsicum",
      price: "19",
      wt: "250 g",
    },
    {
      cat: "veg",
      image:
        "https://cdn.grofers.com/cdn-cgi/image/f=auto,fit=scale-down,q=85,metadata=none,w=250,h=250/app/images/products/sliding_image/3888a.jpg",
      name: "Green Capsicum",
      price: "19",
      wt: "250 g",
    },
    {
      cat: "veg",
      image:
        "https://cdn.grofers.com/cdn-cgi/image/f=auto,fit=scale-down,q=85,metadata=none,w=250,h=250/app/images/products/sliding_image/3888a.jpg",
      name: "Green Capsicum",
      price: "19",
      wt: "250 g",
    },
  ];
  if (cartArr.length != 0) {
    document.getElementById("subcart").style.display = "inline";
    document.getElementById("zz").style.display = "inline";
  } else {
    document.getElementById("cartEmptyImg").style.display = "block";
    document.getElementById("billed").style.opacity = "0.1";
  }
  displayCart(cartArr);
  function displayCart(cartArr) {
    var billTotal = 0;
    cartArr.map((el) => {
      billTotal += Number(el.price);
      let mainDiv = document.createElement("div");
      mainDiv.style.display = "flex";
      let imgdiv = document.createElement("div");
      let img = document.createElement("img");
      img.style.width = "100px";
      img.style.height = "100px";
      img.src = el.image;
      imgdiv.append(img);

      let pDiv = document.createElement("div");
      let p = document.createElement("p");
      p.innerText = el.name;
      let pr = document.createElement("p");
      pr.innerText = "₹" + el.price;
      let wt = document.createElement("p");
      wt.innerText = el.wt;
      pDiv.append(p, pr, wt);

      mainDiv.append(imgdiv, pDiv);

      document.getElementById("zz").append(mainDiv);
    });
    document.getElementById("totalBill").innerText =
      "bill total:" + " " + "₹" + billTotal;
    document.getElementById("myCart").innerText = "₹" + billTotal;
  }

  document.getElementById("billed").addEventListener("click", () => {
    window.location.href = "payment.html";
  });
</script>
